{% extends "base_map.html" %} {% load static %} {% block content %}

    <div id="overlay" style="z-index: 100000">
        <div class="cv-spinner">
            <span class="spinner"></span>
        </div>
    </div>
    <div
            id="sidebarChart"
            style="
    position: absolute;
    right: 0;
    width: calc(100% - 490px);
    margin-left: 10px;
    margin-right: 10px;
    background: white;
    z-index: 10000;
    margin-top: 10px;
    border-radius: 4px;
    box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
    height: auto;
    display: none;
    padding:10px;
    overflow-x:auto
  "
    >
        <!-- Nav tabs -->
        <div id="chart-container">
            <canvas id="chart"></canvas>
        </div>
        <div id="tableChart"></div>
    </div>
    <div id="sidebar" class="sidebar">
        <!-- Nav tabs -->
        <div class="sidebar-tabs">
            <ul role="tablist" id="mainTabs">
                <li class="active">
                    <a href="#home" role="tab"><i class="fa fa-bars"></i></a>
                </li>
                <li>
                    <a href="#filter" role="tab"><i class="fa fa-filter"></i></a>
                </li>
                <li>
                    <a href="#chart-tab" role="tab"><i class="fa fa-bar-chart-o"></i></a>
                </li>
                {% if perms.dynamic.can_extract %}
                    <li>
                        <a href="#attributes" role="tab"><i class="fa fa-pencil"></i></a>
                    </li>
                    <li>
                        <a href="#edit-history" role="tab"><i class="fa fa-history"></i></a>
                    </li>
                    <li>
                        <a href="#alarms" role="tab"
                        ><i class="fa fa-exclamation-triangle"></i
                        ></a>
                    </li>
                    <li>
                        <a href="{% url "extract-page" %}" target="_blank"
                        ><i class="fa fa-download"></i
                        ></a>
                    </li>
                {% endif %}
            </ul>
        </div>

        <!-- Tab panes -->
        <div class="sidebar-content">
            <div class="sidebar-pane active" id="home">
                <h1 class="sidebar-header">
                    Search
                    <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
                </h1>
                <div class="pt-2">
                    Select date and hour:
                    <div class="d-flex flex-row justify-content-center my-1">
                        <div class="d-flex flex-column justify-content-between">
                            <button id="moreTime" class="btn btn-link">
                                <i class="fa fa-arrow-up"></i>
                            </button>
                            <div class="position-relative mr-2">
                                <input
                                        type="text"
                                        id="datetimepicker"
                                        class="form-control form-control-sm datetimepicker-input col-xs-10 to-disable"
                                        data-target="#datetimepicker"
                                        data-toggle="datetimepicker"
                                        autocomplete="off"
                                />
                            </div>
                            <button id="lessTime" class="btn btn-link">
                                <i class="fa fa-arrow-down"></i>
                            </button>
                        </div>
                        <div class="d-flex flex-column justify-content-between">
                            <button id="moreHour" class="btn btn-link">
                                <i class="fa fa-arrow-up"></i>
                            </button>
                            <select
                                    class="form-control form-control-sm to-disable w-auto updateOnClick"
                                    id="hour"
                                    name="hour"
                            >
                                <option value="*" selected>*</option>
                                <option value="00">00</option>
                                <option value="01">01</option>
                                <option value="02">02</option>
                                <option value="03">03</option>
                                <option value="04">04</option>
                                <option value="05">05</option>
                                <option value="06">06</option>
                                <option value="07">07</option>
                                <option value="08">08</option>
                                <option value="09">09</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="15">15</option>
                                <option value="16">16</option>
                                <option value="17">17</option>
                                <option value="18">18</option>
                                <option value="19">19</option>
                                <option value="20">20</option>
                                <option value="21">21</option>
                                <option value="22">22</option>
                                <option value="23">23</option>
                            </select>
                            <button id="lessHour" class="btn btn-link">
                                <i class="fa fa-arrow-down"></i>
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        Type of object:<br/>
                        <div class="form-check form-check-inline">
                            <input
                                    class="form-check-input updateOnClick"
                                    checked
                                    type="radio"
                                    name="objectToShow"
                                    id="inlineRadio2"
                                    value="data"
                            />
                            <label class="form-check-label" for="inlineRadio2">Data</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input
                                    class="form-check-input updateOnClick"
                                    type="radio"
                                    name="objectToShow"
                                    id="inlineRadio1"
                                    value="stations"
                            />
                            <label class="form-check-label" for="inlineRadio1">Stations</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input
                                    class="form-check-input updateOnClick"
                                    type="radio"
                                    name="objectToShow"
                                    id="inlineRadio3"
                                    value="constantStationData"
                            />
                            <label class="form-check-label" for="inlineRadio3">
                                Constant station data</label
                            >
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="ident">Ident</label>
                        <select
                                id="ident"
                                class="form-control form-control-sm updateOnClick search-form"
                                name="ident"
                        >
                            <option value="*" selected>*</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="lon_lat" style="width: 100%">Lon lat</label>
                        <select
                                id="lon_lat"
                                class="form-control form-control-sm updateOnClick search-form"
                                name="lon_lat"
                        >
                            <option value="*" selected>*</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="network" style="width: 100%">Network</label>
                        <select
                                id="network"
                                class="form-control form-control-sm updateOnClick search-form"
                                name="network"
                        >
                            <option value="*" selected>*</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="vars" style="width: 100%">Vars</label>
                        <select
                                class="form-control form-control-sm to-disable updateOnClick search-form"
                                id="vars"
                                name="vars"
                        >
                            <option value="*" selected>*</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="timerange" style="width: 100%">Timerange</label>
                        <select
                                class="form-control form-control-sm to-disable updateOnClick search-form"
                                id="timerange"
                                name="timerange"
                        >
                            <option value="*" selected>*</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="level" style="width: 100%">Level</label>
                        <select
                                class="form-control form-control-sm to-disable updateOnClick search-form"
                                id="level"
                                name="level"
                        >
                            <option value="*" selected>*</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="dsn" style="width: 100%">DSN</label>
                        <select
                                class="form-control form-control-sm updateOnClick"
                                id="dsn"
                                name="dsn"
                        >
                            <option value="report_fixed">report_fixed</option>
                            <option value="sample_fixed">sample_fixed</option>
                        </select>
                    </div>
                    <button data-url="" class="btn btn-outline-primary get-borinud-url w-100" id="url-borinud-data">
                        Copia url
                    </button>

                </div>
            </div>
            <div class="sidebar-pane" id="filter">
                <h1 class="sidebar-header">
                    Filter data
                    <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
                </h1>
                <div class="pt-2">
                    <div class="row my-2">
                        <div class="col-12">B33196:</div>
                        <div class="col-12">
                            <div class="form-check form-check-inline">
                                <input
                                        class="form-check-input"
                                        name="invalidData"
                                        value="0"
                                        type="radio"
                                        id="invalidData1"
                                />
                                <label class="form-check-label" for="invalidData1">All</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input
                                        class="form-check-input"
                                        name="invalidData"
                                        value="1"
                                        type="radio"
                                        id="invalidData2"
                                        checked
                                />
                                <label class="form-check-label" for="invalidData2"
                                >Only valid</label
                                >
                            </div>
                            <div class="form-check form-check-inline">
                                <input
                                        class="form-check-input"
                                        name="invalidData"
                                        value="2"
                                        type="radio"
                                        id="invalidData3"
                                />
                                <label class="form-check-label" for="invalidData3"
                                >Only invalid</label
                                >
                            </div>
                        </div>
                    </div>
                    <div class="row my-2">
                        <div class="col-12">
                            <div class="row">
                                <div class="col-12">B33192</div>
                                <div class="col-auto">
                                    <input
                                            type="checkbox"
                                            name="checkFilterB33192"
                                            id="checkFilterB33192"
                                    />
                                </div>
                                <div class="col mt-1">
                                    <div id="filterB33192"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row my-2">
                        <div class="col-12">
                            <div class="row">
                                <div class="col-12">B33193</div>
                                <div class="col-auto">
                                    <input
                                            type="checkbox"
                                            name="checkFilterB33193"
                                            id="checkFilterB33193"
                                    />
                                </div>
                                <div class="col mt-1">
                                    <div id="filterB33193"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row my-2">
                        <div class="col-12">
                            <div class="row">
                                <div class="col-12">B33194</div>
                                <div class="col-auto">
                                    <input
                                            type="checkbox"
                                            name="checkFilterB33194"
                                            id="checkFilterB33194"
                                    />
                                </div>
                                <div class="col mt-1">
                                    <div id="filterB33194"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row my-2">
                        <div class="col-12">
                            <button class="btn btn-outline-primary btn-block" id="applyFilter">
                                <div class="d-flex flex-row justify-content-between">
                                    <i class="fa fa-filter"></i>
                                    FILTER
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            {% if perms.dynamic.can_extract %}
                <div class="sidebar-pane" id="attributes">
                    <h1 class="sidebar-header">
                        Edit attributes
                        <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
                    </h1>
                    <ul class="nav nav-tabs nav-fill mt-2 edit-tabs" role="tablist">
                        <li class="nav-item">
                            <a
                                    class="nav-link active"
                                    id="data-tab"
                                    data-toggle="tab"
                                    href="#data"
                                    role="tab"
                                    aria-controls="data"
                                    aria-selected="true"
                            >Data</a
                            >
                        </li>
                        <li class="nav-item">
                            <a
                                    class="nav-link edit-tabs"
                                    id="stations-tab"
                                    data-toggle="tab"
                                    href="#stations"
                                    role="tab"
                                    aria-controls="stations"
                                    aria-selected="false"
                            >Stations</a
                            >
                        </li>
                    </ul>
                    <div class="tab-content" id="myTabContent">
                        <div
                                class="tab-pane fade show active"
                                id="data"
                                role="tabpanel"
                                aria-labelledby="data-tab"
                        >
                            <div class="pt-2">
                                <div class="my-2 d-flex flex-row justify-content-between">
                                    <button
                                            id="validate"
                                            class="btn btn-outline-success w-100 mr-1 validateButton"
                                    >
                                        Validate
                                    </button>

                                    <button
                                            id="invalidate"
                                            class="btn btn-outline-danger w-100 ml-1 validateButton"
                                    >
                                        Invalidate
                                    </button>
                                </div>
                                <div class="table-responsive">
                                    <table
                                            class="table table-sm table-bordered table-hover table-striped"
                                            id="selectedData"
                                    >
                                        <caption>
                                            Selected data
                                        </caption>
                                        <thead>
                                        <tr>
                                            <th>
                                                <button class="btn btn-sm btn-danger" id="removeAll">
                                                    <i class="fa fa-trash"></i>
                                                </button>
                                            </th>
                                            <th>Ident</th>
                                            <th>Longitudine</th>
                                            <th>Latitudine</th>
                                            <th>network</th>
                                            <th>Timerange</th>
                                            <th>Level</th>
                                            <th>Var</th>
                                            <th>Date</th>
                                        </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div
                                class="tab-pane fade"
                                id="stations"
                                role="tabpanel"
                                aria-labelledby="stations-tab"
                        >
                            <div class="pt-2">
                                <div class="row my-2">
                                    <div class="col-12">
                                        <div class="row px-3">
                                            <div class="col-12">
                                                Height of station ground above mean sea level
                                            </div>
                                            <div class="col-12 mt-1">
                                                <div id="filterStationsB07030"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row my-2">
                                    <div class="col-12">
                                        <div class="row px-3">
                                            <div class="col-12">
                                                Height of barometer above mean sea level
                                            </div>
                                            <div class="col mt-1">
                                                <div id="filterStationsB07031"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <button
                                        class="btn btn-primary btn-outline btn-block"
                                        id="addStationsFromConstantData"
                                >
                                    Add stations
                                </button>
                                <hr style="width: 100%"/>
                                <div class="form-group">
                                    <label for="startDateI">Initial date</label>
                                    <div
                                            class="input-group date"
                                            id="startDateI"
                                            data-target-input="nearest"
                                    >
                                        <input
                                                type="text"
                                                id="inputStartDateI"
                                                class="form-control datetimepicker-input"
                                                data-target="#startDateI"
                                        />
                                        <div
                                                class="input-group-append"
                                                data-target="#startDateI"
                                                data-toggle="datetimepicker"
                                        >
                                            <div class="input-group-text">
                                                <i class="fa fa-calendar"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="startDateI">Final date</label>
                                    <div
                                            class="input-group date"
                                            id="finalDateI"
                                            data-target-input="nearest"
                                    >
                                        <input
                                                type="text"
                                                id="inputFinalDateI"
                                                class="form-control datetimepicker-input"
                                                data-target="#finalDateI"
                                        />
                                        <div
                                                class="input-group-append"
                                                data-target="#finalDateI"
                                                data-toggle="datetimepicker"
                                        >
                                            <div class="input-group-text">
                                                <i class="fa fa-calendar"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="varsInvalidation" style="width: 100%">Vars</label>
                                    <select
                                            class="form-control form-control-sm"
                                            id="varsInvalidation"
                                            style="height: 200px"
                                            name="varsInvalidation"
                                            multiple
                                    ></select>
                                </div>
                                <div class="form-group">
                                    <label for="trangeInvalidation" style="width: 100%"
                                    >Timerange</label
                                    >
                                    <select
                                            class="form-control form-control-sm"
                                            id="trangeInvalidation"
                                            style="height: 200px"
                                            name="trangeInvalidation"
                                            multiple
                                    ></select>
                                </div>
                                <div class="form-group">
                                    <label for="levelInvalidation" style="width: 100%">Level</label>
                                    <select
                                            class="form-control form-control-sm"
                                            id="levelInvalidation"
                                            name="levelInvalidation"
                                            multiple
                                    ></select>
                                </div>

                                <hr style="width: 100%"/>
                                <p class="mt-2">Selected stations:</p>
                                <div class="my-2 d-flex flex-row justify-content-between">
                                    <button
                                            id="validateStations"
                                            class="btn btn-outline-success w-100 mr-1 validateButtonStations"
                                    >
                                        Validate
                                    </button>

                                    <button
                                            id="invalidateStations"
                                            class="btn btn-outline-danger w-100 ml-1 validateButtonStations"
                                    >
                                        Invalidate
                                    </button>
                                </div>
                                <div class="table-responsive">
                                    <table
                                            class="table table-sm table-bordered table-hover table-striped"
                                            id="selectedStations"
                                    >
                                        <caption>
                                            Selected stations
                                        </caption>
                                        <thead>
                                        <tr>
                                            <th>
                                                <button
                                                        class="btn btn-sm btn-danger"
                                                        id="removeAllStations"
                                                >
                                                    <i class="fa fa-trash"></i>
                                                </button>
                                            </th>
                                            <th>Ident</th>
                                            <th>Longitudine</th>
                                            <th>Latitudine</th>
                                            <th>network</th>
                                        </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sidebar-pane" id="edit-history">
                    <h1 class="sidebar-header">
                        Edit history
                        <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
                    </h1>
                    <ul class="nav nav-tabs nav-fill mt-2 edit-history-tabs" role="tablist">
                        <li class="nav-item">
                            <a
                                    class="nav-link active"
                                    id="data-history-tab"
                                    data-toggle="tab"
                                    href="#data-history"
                                    role="tab"
                                    aria-controls="data"
                                    aria-selected="true"
                            >Data</a
                            >
                        </li>
                        <li class="nav-item">
                            <a
                                    class="nav-link edit-tabs"
                                    id="stations-history-tab"
                                    data-toggle="tab"
                                    href="#stations-history"
                                    role="tab"
                                    aria-controls="stations"
                                    aria-selected="false"
                            >Stations</a
                            >
                        </li>
                    </ul>
                    <div class="tab-content" id="history-tab-content">
                        <div
                                class="tab-pane fade show active"
                                id="data-history"
                                role="tabpanel"
                                aria-labelledby="data-history-tab"
                        >
                            <div class="pt-2">
                                <div class="card">
                                    <ul
                                            class="list-group list-group-flush"
                                            id="data-history-list"
                                    ></ul>
                                </div>
                                <div class="d-flex flex-row justify-content-between">
                                    <button class="btn btn-link" data-url="" id="prevHistoryData">
                                        <i class="fa fa-arrow-left"></i>
                                    </button>
                                    <button class="btn btn-link" data-url="" id="nextHistoryData">
                                        <i class="fa fa-arrow-right"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div
                                class="tab-pane fade"
                                id="stations-history"
                                role="tabpanel"
                                aria-labelledby="stations-history-tab"
                        >
                            <div class="pt-2">
                                <div class="card">
                                    <ul
                                            class="list-group list-group-flush"
                                            id="station-history-list"
                                    ></ul>
                                </div>
                                <div class="d-flex flex-row justify-content-between">
                                    <button class="btn btn-link" data-url="" id="prevHistoryStation">
                                        <i class="fa fa-arrow-left"></i>
                                    </button>
                                    <button class="btn btn-link" data-url="" id="nextHistoryStation">
                                        <i class="fa fa-arrow-right"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sidebar-pane" id="alarms">
                    <h1 class="sidebar-header">
                        Alarms
                        <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
                    </h1>

                    <div class="pt-2">
                        <div class="row my-2">
                            <div class="col-12">
                                <div class="d-flex flex-row justify-content-between">
                                    <div class="d-flex flex-column justify-content-between mr-2">
                                        <label for="startDateFirstPeriod"
                                        >Start date first period</label
                                        >
                                        <div
                                                class="input-group date"
                                                id="startDateFirstPeriod"
                                                data-target-input="nearest"
                                        >
                                            <input
                                                    type="text"
                                                    id="startDateFirstPeriodInput"
                                                    class="form-control datetimepicker-input"
                                                    data-target="#startDateFirstPeriod"
                                            />
                                            <div
                                                    class="input-group-append"
                                                    data-target="#startDateFirstPeriod"
                                                    data-toggle="datetimepicker"
                                            >
                                                <div class="input-group-text">
                                                    <i class="fa fa-calendar"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="d-flex flex-column justify-content-between">
                                        <label for="endDateFirstPeriod">End date first period</label>
                                        <div
                                                class="input-group date"
                                                id="endDateFirstPeriod"
                                                data-target-input="nearest"
                                        >
                                            <input
                                                    type="text"
                                                    id="endDateFirstPeriodInput"
                                                    class="form-control datetimepicker-input"
                                                    data-target="#endDateFirstPeriod"
                                            />
                                            <div
                                                    class="input-group-append"
                                                    data-target="#endDateFirstPeriod"
                                                    data-toggle="datetimepicker"
                                            >
                                                <div class="input-group-text">
                                                    <i class="fa fa-calendar"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="d-flex flex-row justify-content-between">
                                    <div class="d-flex flex-column justify-content-between mr-2">
                                        <label for="startDateSecondPeriod"
                                        >Start date second period</label
                                        >
                                        <div
                                                class="input-group date"
                                                id="startDateSecondPeriod"
                                                data-target-input="nearest"
                                        >
                                            <input
                                                    type="text"
                                                    id="startDateSecondPeriodInput"
                                                    class="form-control datetimepicker-input"
                                                    data-target="#startDateSecondPeriod"
                                            />
                                            <div
                                                    class="input-group-append"
                                                    data-target="#startDateSecondPeriod"
                                                    data-toggle="datetimepicker"
                                            >
                                                <div class="input-group-text">
                                                    <i class="fa fa-calendar"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="d-flex flex-column justify-content-between">
                                        <label for="endDateSecondPeriod">End date second period</label>
                                        <div
                                                class="input-group date"
                                                id="endDateSecondPeriod"
                                                data-target-input="nearest"
                                        >
                                            <input
                                                    type="text"
                                                    id="endDateSecondPeriodInput"
                                                    class="form-control datetimepicker-input"
                                                    data-target="#endDateSecondPeriod"
                                            />
                                            <div
                                                    class="input-group-append"
                                                    data-target="#endDateSecondPeriod"
                                                    data-toggle="datetimepicker"
                                            >
                                                <div class="input-group-text">
                                                    <i class="fa fa-calendar"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 mt-3">
                                <button
                                        class="btn btn-outline-primary btn-block"
                                        id="comparePeriods"
                                >
                                    <div class="d-flex flex-row justify-content-between">
                                        <i class="fa fa-bar-chart"></i>
                                        COMPARE PERIODS
                                    </div>
                                </button>
                            </div>

                            <hr class="my-3" style="width: 100%"/>
                            <div class="col-12">Status:</div>
                            <div class="col-12">
                                <div class="form-check form-check-inline">
                                    <input
                                            class="form-check-input"
                                            name="statusAlarms"
                                            value="0"
                                            type="radio"
                                            id="statusAlarms1"
                                    />
                                    <label class="form-check-label" for="statusAlarms1">All</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input
                                            class="form-check-input"
                                            name="statusAlarms"
                                            value="1"
                                            type="radio"
                                            id="statusAlarms2"
                                            checked
                                    />
                                    <label class="form-check-label" for="statusAlarms2">Active</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input
                                            class="form-check-input"
                                            name="statusAlarms"
                                            value="2"
                                            type="radio"
                                            id="statusAlarms3"
                                    />
                                    <label class="form-check-label" for="statusAlarms3"
                                    >Disabled</label
                                    >
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="form-group">
                                    <label for="networkAlarm" style="width: 100%">Network</label>
                                    <select
                                            id="networkAlarm"
                                            class="form-control form-control-sm"
                                            name="networkAlarm"
                                    >
                                        <option value="*" selected>*</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="form-group">
                                    <label for="varAlarm" style="width: 100%">Bcode</label>
                                    <select
                                            id="varAlarm"
                                            class="form-control form-control-sm"
                                            name="varAlarm"
                                    >
                                        <option value="*" selected>*</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-12">
                                <button
                                        class="btn btn-outline-primary btn-block"
                                        id="applyFilterAlarms"
                                >
                                    <div class="d-flex flex-row justify-content-between">
                                        <i class="fa fa-filter"></i>
                                        FILTER
                                    </div>
                                </button>
                            </div>
                        </div>
                        <div id="alarms-list"></div>
                        <div class="d-flex flex-row justify-content-between">
                            <button class="btn btn-link" data-url="" id="prevAlarms">
                                <i class="fa fa-arrow-left"></i>
                            </button>
                            <button class="btn btn-link" data-url="" id="nextAlarms">
                                <i class="fa fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>

            {% endif %}
            <div class="sidebar-pane" id="chart-tab">
                <h1 class="sidebar-header">
                    Search
                    <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
                </h1>
                <div class="pt-2">
                    Select date and hour:
                    <div class="d-flex flex-row justify-content-center my-1">
                        <div class="d-flex flex-column justify-content-between">
                            <button id="moreTimeGraph" class="btn btn-link">
                                <i class="fa fa-arrow-up"></i>
                            </button>
                            <div class="position-relative mr-2">
                                <input
                                        type="text"
                                        id="datetimepickerGraph"
                                        class="form-control form-control-sm datetimepicker-input col-xs-10"
                                        data-target="#datetimepickerGraph"
                                        data-toggle="datetimepicker"
                                />
                            </div>
                            <button id="lessTimeGraph" class="btn btn-link">
                                <i class="fa fa-arrow-down"></i>
                            </button>
                        </div>
                        <div class="d-flex flex-column justify-content-between">
                            <button id="moreHourGraph" class="btn btn-link">
                                <i class="fa fa-arrow-up"></i>
                            </button>
                            <select
                                    class="form-control form-control-sm w-auto"
                                    id="hourGraph"
                                    name="hourGraph"
                            >
                                <option value="*" selected>*</option>
                                <option value="00">00</option>
                                <option value="01">01</option>
                                <option value="02">02</option>
                                <option value="03">03</option>
                                <option value="04">04</option>
                                <option value="05">05</option>
                                <option value="06">06</option>
                                <option value="07">07</option>
                                <option value="08">08</option>
                                <option value="09">09</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="15">15</option>
                                <option value="16">16</option>
                                <option value="17">17</option>
                                <option value="18">18</option>
                                <option value="19">19</option>
                                <option value="20">20</option>
                                <option value="21">21</option>
                                <option value="22">22</option>
                                <option value="23">23</option>
                            </select>
                            <button id="lessHourGraph" class="btn btn-link">
                                <i class="fa fa-arrow-down"></i>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="identGraph">Ident</label>
                        <select
                                id="identGraph"
                                class="form-control form-control-sm search-form-graph"
                                name="identGraph"
                        >
                            <option value="*" selected>*</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="lon_latGraph" style="width: 100%">Lon lat</label>
                        <select
                                id="lon_latGraph"
                                class="form-control form-control-sm search-form-graph"
                                name="lon_latGraph"
                        >
                            <option value="*" selected>*</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="networkGraph" style="width: 100%">Network</label>
                        <select
                                id="networkGraph"
                                class="form-control form-control-sm search-form-graph "
                                name="networkGraph"
                        >
                            <option value="*" selected>*</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="varsGraph" style="width: 100%">Vars</label>
                        <select
                                class="form-control form-control-sm search-form-graph"
                                id="varsGraph"
                                name="varsGraph"
                        >
                            <option value="*" selected>*</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="timerangeGraph" style="width: 100%">Timerange</label>
                        <select
                                class="form-control form-control-sm search-form-graph"
                                id="timerangeGraph"
                                name="timerangeGraph"
                        >
                            <option value="*" selected>*</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="levelGraph" style="width: 100%">Level</label>
                        <select
                                class="form-control form-control-sm search-form-graph"
                                id="levelGraph"
                                name="levelGraph"
                        >
                            <option value="*" selected>*</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="dsnGraph" style="width: 100%">DSN</label>
                        <select
                                class="form-control form-control-sm "
                                id="dsnGraph"
                                name="dsnGraph"
                        >
                            <option value="report_fixed">report_fixed</option>
                            <option value="sample_fixed">sample_fixed</option>
                        </select>
                    </div>

                    <div class="row">
                        <div class="col-12 text-center">
                            <button
                                    class="btn btn-outline-primary btn-block"

                                    id="showGraphButton"
                            >
                                <div class="d-flex flex-row justify-content-between">
                                    <i class="fa fa-line-chart"></i>
                                    Add to graph
                                </div>
                            </button>
                            <button
                                    class="btn btn-outline-primary btn-block"
                                    style="display: none"
                                    id="showWindRose"
                            >
                                <div class="d-flex flex-row justify-content-between">
                                    <i class="fa fa-pie-chart"></i>
                                    WIND ROSE GRAPH
                                </div>
                            </button>
                        </div>
                        <div class="col-12 mt-2">
                            <button data-url="" class="btn btn-outline-primary get-borinud-url w-100"
                                    id="url-borinud-graph">
                                Copia url
                            </button>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>


    <div id="map" class="sidebar-map"></div>

    <div class="modal" id="modalWindRose" tabindex="-1" role="dialog" style="z-index: 99999;">
        <div class="modal-dialog" role="document" style="max-width: 1000px">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="row">
                        <!-- for plotly bug in modal -->
                        <div class="col-1"></div>
                        <div class="col-md-5" id="windRoseContainer"></div>
                        <div class="col-md-5" id="windRoseSpeedContainer"></div>
                        <!-- for plotly bug in modal -->

                        <div class="col-1"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>
{% endblock %} {% block javascript %}
    <script src="{% static 'dynamic/js/structure/publish-subscribe.js' %}"></script>
    <script src="{% static 'dynamic/js/structure/search-form.js' %}"></script>
    <script src="{% static 'dynamic/js/structure/search-form-view.js' %}"></script>
    <script src="{% static 'dynamic/js/structure/edit-data-collection.js' %}"></script>
    <script src="{% static 'dynamic/js/structure/alarm-collection.js' %}"></script>
    <script src="{% static 'dynamic/js/structure/alarm-view.js' %}"></script>
    <script src="{% static 'dynamic/js/structure/graph/graph-wind-rose.js' %}"></script>
    <script src="{% static 'dynamic/js/structure/graph/query-collection.js' %}"></script>
    <script src="{% static 'dynamic/js/structure/graph/graph-view.js' %}"></script>
    <script src="{% static 'dynamic/js/structure/data-collection.js' %}"></script>
    <script src="{% static 'dynamic/js/structure/edit-data-view.js' %}"></script>
    <script src="{% static 'dynamic/js/structure/edit-station-history-collection.js' %}"></script>
    <script src="{% static 'dynamic/js/structure/edit-station-history-view.js' %}"></script>
    <script src="{% static 'dynamic/js/structure/edit-data-history-collection.js' %}"></script>
    <script src="{% static 'dynamic/js/structure/edit-data-history-view.js' %}"></script>
    <script src="{% static 'dynamic/js/structure/edit-station-collection.js' %}"></script>
    <script src="{% static 'dynamic/js/structure/edit-station-view.js' %}"></script>
    <script src="{% static 'dynamic/js/structure/map-view.js' %}"></script>
    <script src="{% static 'dynamic/js/structure/edit-tab-view.js' %}"></script>
    <script src="{% static 'dynamic/js/structure/invalidation-vars-form-view.js' %}"></script>
    <script>
        $(function () {
            $(".get-borinud-url").on("click", function () {
                const copyText = $(this).attr("data-url");
                if (copyText === "") {
                    alert("Nessuna ricerca effettuata")
                } else {
                    copyToClipBoard(copyText);
                    alert("Fatto!")
                }

                // Or...
                //var elems = document.getElementsByClassName("hl7MsgBox");
                //var copyText = elems[0].textContent;


            })

            const overlay = $("#overlay")

            const searchForm = new SearchForm();

            const searchFormView = new SearchFormView(searchForm, "{{ url_borinud }}", overlay, "", "search-form");
            searchFormView.initEvents();

            const searchFormGraph = new SearchForm();

            const searchFormGraphView = new SearchFormView(searchFormGraph, "{{ url_borinud }}", overlay, "Graph", "search-form-graph");
            searchFormGraphView.initEvents();

            const pruneCluster = new PruneClusterForLeaflet();
            const pruneClusterStations = new PruneClusterForLeaflet();
            const todayDateSummary = moment(new Date()).format("YYYY/MM")
            PruneCluster.Cluster.ENABLE_MARKERS_LIST = true
            const map = L.map('map', {
                zoomControl: false,
                timeDimension: true,
                //timeDimensionControl: true,
                //timeDimensionControlOptions: {position: "bottomright"}
                times: [$("#hours").val() ? $("#hours").val() !== "*" : new Date()]
            }).setView([43, 11], 13);
            var legend = L.control({position: 'bottomright'});

            L.control.zoom({position: 'topright'}).addTo(map);
            let sidebar = L.control.sidebar('sidebar')
            sidebar.addTo(map);
            const queryCollection = new QueryCollection()
            queryCollection.subscribe()
            const graphView = new GraphView(queryCollection, "{{url_borinud}}", sidebar, overlay);
            graphView.initEvents()
            var sliderTimeControl = L.Control.extend({
                options: {position: 'bottomleft'},
                onAdd: function (map) {
                    var el = L.DomUtil.create('div', 'leaflet-bar slider-control');
                    el.innerHTML = '<div id="sliderTime"></div>';
                    return el;
                }
            });
            map.addControl(new sliderTimeControl());


            const mapView = new MapView("{{url_borinud}}", map, pruneCluster, legend, overlay, "{% url "wms" %}", "{% static 'dynamic/images/map-not-found.png' %}", "{% url "mapserver-wms"%}")
            mapView.initEvents()
            {% if perms.dynamic.can_extract %}

                const stationCollection = new DataCollection()
                const varCollection = new DataCollection()
                let networks = []
                let vars = []

                async function fetchVm2Table(url, responseKey, collection, itemKey) {
                    let response = await $.ajax({
                        url: url,
                        dataType: "json",
                    })
                    let returnArray = [...new Set(response[responseKey].map((variable) => variable[itemKey]))]
                    collection.addMultiple(response[responseKey])
                    return returnArray
                }
                fetchVm2Table("{% url "get-all-vars-vm2" %}", "variables", varCollection, "bcode").then((vars) => {

                    fetchVm2Table("{% url "get-all-stations-vm2" %}", "stations", stationCollection, "network").then((networks) => {

                        const alarmCollection = new AlarmCollection();
                        alarmCollection.subscribe();

                        const alarmView = new AlarmView(alarmCollection, map, {
                            networks: networks,
                            vars: vars
                        }, sidebar);
                        alarmView.initEvents();

                        const editDataCollection = new EditDataCollection();
                        editDataCollection.subscribe();

                        const editDataView = new EditDataView(editDataCollection, map, pruneCluster, overlay);
                        editDataView.initEvents();

                        const editStationCollection = new EditStationCollection();
                        editStationCollection.subscribe();

                        const editStationView = new EditStationView(editStationCollection, map, pruneClusterStations, overlay, "{{ url_borinud }}", stationCollection);
                        editStationView.initEvents();

                        const editTabView = new EditTabView("{{url_borinud}}", map, pruneCluster, overlay, pruneClusterStations, stationCollection)
                        editTabView.initEvents()

                        const editStationHistoryCollection = new EditStationHistoryCollection();
                        editStationHistoryCollection.subscribe();

                        const editStationHistoryView = new EditStationHistoryView(editStationHistoryCollection, map);
                        editStationHistoryView.initEvents();

                        const editDataHistoryCollection = new EditDataHistoryCollection();
                        editDataHistoryCollection.subscribe();

                        const editDataHistoryView = new EditDataHistoryView(editDataHistoryCollection, map);
                        editDataHistoryView.initEvents();

                    })
                })



                var drawnItems = new L.FeatureGroup();
                map.addLayer(drawnItems);
                var drawControl = new L.Control.Draw({
                    draw: {
                        marker: false,
                        circlemarker: false,
                        polyline: false,
                        circle: false,
                        rectangle: false
                    },
                    edit: {
                        featureGroup: drawnItems,
                        edit: false,
                        remove: false
                    }
                });
                map.addControl(drawControl);
            {% endif %}

        });
    </script>

{% endblock %}
